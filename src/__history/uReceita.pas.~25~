unit uReceita;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Vcl.StdCtrls, Vcl.Grids,
  Vcl.DBGrids, Vcl.Buttons, Vcl.ExtCtrls;

type
  TfrmReceita = class(TForm)
    pnlTop: TPanel;
    Label1: TLabel;
    pnlMid: TPanel;
    Panel1: TPanel;
    rbIdProduto: TRadioButton;
    rbNomeProduto: TRadioButton;
    edtBuscar: TEdit;
    btnPesquisar: TBitBtn;
    Panel3: TPanel;
    btnCancelar: TBitBtn;
    btnConfirmar: TBitBtn;
    pnlGrid: TPanel;
    grdProduto: TDBGrid;
    edtCodTecnico: TEdit;
    edtNomeTecnico: TEdit;
    btnPesqTecnico: TButton;
    edtCodReceita: TEdit;
    edtCodPedido: TEdit;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    procedure btnPesquisarClick(Sender: TObject);
    procedure btnPesqTecnicoClick(Sender: TObject);
    procedure btnConfirmarClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmReceita: TfrmReceita;

implementation

uses uDmPrincipal, uPersistance, uPesqTecnico;

{$R *.dfm}

procedure TfrmReceita.btnConfirmarClick(Sender: TObject);
begin
  if edtCodReceita.Text = EmptyStr then
  begin
    ShowMessage('Selecione uma receita na grid acima.');
    Exit;
  end;

  if edtCodTecnico.Text = EmptyStr then
  begin
    ShowMessage('Selecione uma técnico no campo acima.');
    Exit;
  end;

  Persistence.AssinarReceita(StrToInt(edtCodPedido.Text), StrToInt(edtCodTecnico.Text));
  Persistence.AprovarPedido(StrToInt(edtCodPedido.Text));

end;

procedure TfrmReceita.btnPesqTecnicoClick(Sender: TObject);
begin
  if TForm(frmPesqTecnico) = nil then
  begin
    Application.CreateForm(TfrmPesqTecnico, TForm(frmPesqTecnico));
  end;
  TForm(frmPesqTecnico).ShowModal;
end;

procedure TfrmReceita.btnPesquisarClick(Sender: TObject);
begin
  try
    dmPrincipal.qryReceitas.Close;
    dmPrincipal.qryReceitas.SQL.Text := '';
    dmPrincipal.qryReceitas.SQL.Text := 'SELECT * FROM RECEITAS ';

    if edtBuscar.Text <> '' then
    begin
      dmPrincipal.qryReceitas.SQL.Text := dmPrincipal.qryReceitas.SQL.Text + 'WHERE ID_RECEITA = ' + edtBuscar.Text;
      dmPrincipal.qryReceitas.SQL.Text := dmPrincipal.qryReceitas.SQL.Text + 'WHERE ID_TECNICO_AGRICOLA = ' + edtBuscar.Text;
    end;

    dmPrincipal.qryReceitas.SQL.Text := dmPrincipal.qryReceitas.SQL.Text + ' ORDER BY ID_RECEITA';
    dmPrincipal.qryReceitas.Open();

  except
    on e:exception do
    begin
     ShowMessage('Erro ao pesquisar receita. - Erro: ' + e.Message);
    end;
  end;
end;

end.
