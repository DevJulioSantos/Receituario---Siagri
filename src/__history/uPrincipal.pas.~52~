unit uPrincipal;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Vcl.Grids, Vcl.DBGrids,
  Vcl.ExtCtrls, Vcl.ComCtrls, Vcl.StdCtrls, Vcl.Buttons, Vcl.Mask, Vcl.Menus, inifiles;

type
  TfrmPrincipal = class(TForm)
    MainMenu1: TMainMenu;
    mmCadastroCliente: TMenuItem;
    CadastroProduto1: TMenuItem;
    CadastroTcnicoAgricola1: TMenuItem;
    Pedidos1: TMenuItem;
    Receitas1: TMenuItem;
    procedure mmCadastroClienteClick(Sender: TObject);
    procedure CadastroProduto1Click(Sender: TObject);
    procedure CadastroTcnicoAgricola1Click(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure Pedidos1Click(Sender: TObject);
    procedure Receitas1Click(Sender: TObject);

  private
    procedure CriarFormulario(TFormulario: TFormClass; var Formulario);
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmPrincipal: TfrmPrincipal;

implementation

{$R *.dfm}

uses uDmPrincipal, uPersistance, uCliente, uProduto, uTecnicoAgricola, uPedido, uReceita;

procedure TfrmPrincipal.CadastroProduto1Click(Sender: TObject);
begin
  CriarFormulario(TfrmProdutos, frmProdutos);
end;

procedure TfrmPrincipal.CadastroTcnicoAgricola1Click(Sender: TObject);
begin
  CriarFormulario(TfrmTecnicoAgricola, frmTecnicoAgricola);
end;

procedure TfrmPrincipal.CriarFormulario(TFormulario: TFormClass;  var Formulario);
begin
  if TForm(Formulario) = nil then
  begin
    Application.CreateForm(TFormulario, TForm(Formulario));
  end;
  TForm(Formulario).ShowModal;
end;

procedure TfrmPrincipal.FormShow(Sender: TObject);
var
  vCaminhoBD: TFileName; vCaminhoDLL: String;
begin
  try
    if FileExists(ExtractFilePath(ParamStr(0)) + 'Config.ini') then
    begin
      with TIniFile.Create(ExtractFilePath(ParamStr(0)) + 'Config.ini') do
      begin
         vCaminhoBD  := ReadString('RECEITUARIO', 'CAMINHOBD', '');
         vCaminhoDLL := ReadString('RECEITUARIO', 'CAMINHODLL', '');
      end;

      dmPrincipal.FDConnection.Params.Database := EmptyStr;
      dmPrincipal.FDConnection.Params.Database := vCaminhoBD;

      dmPrincipal.FDPhysFBDriverLink.VendorLib := EmptyStr;
      dmPrincipal.FDPhysFBDriverLink.VendorLib := vCaminhoDLL;
    end
    else
      ShowMessage('Aqeuivo "Config.ini" não encontrado!');
  finally

  end;
end;

procedure TfrmPrincipal.mmCadastroClienteClick(Sender: TObject);
begin
  CriarFormulario(TfrmCliente, frmCliente);
end;

procedure TfrmPrincipal.Pedidos1Click(Sender: TObject);
begin
  CriarFormulario(TfrmPedido, frmPedido);
end;

procedure TfrmPrincipal.Receitas1Click(Sender: TObject);
begin
  CriarFormulario(TForm);
end;

end.
